#!/usr/local/bin/spd

// the new pico system isn't running so fast right now. perhap waitpid delay?
// it quite a long delay, over a second?  Also... we don't want those products made.
|| Fails = faststring()

main (|[string]| Files)
	if !files
		|| proc = "/usr/local/speedie/Examples/arrow.spd".Spawn("arrow")
			app.Sleep(1s)
			printline proc.ReadStdOut
			if proc.status != 0
				printline "arrow.spd status: " + proc.Status.render
		return 0
	
	""
	for f in files.GlobExpand 
		app.TryCompileOne(f)
 
	if Fails.length
		app.say("$fails Failiures")
	  else
		app.say("All OK")


function app.TryCompileOne (|file| f)
	|| args = [f,  "--nocompile",  "--target=ForBatchTest"]
	|| M = ProcessMode.StdOutSilence
	|| Speedie = "/usr/local/bin/spd"
	
	if Speedie.Execute(args, M).Successful
		printline "spd $f --nocompile --silent --check --target=ForBatchTest"
		// useful for me to run from the command-line to debug Pico
	  else
		fails <~ "Fail: $f\n"

