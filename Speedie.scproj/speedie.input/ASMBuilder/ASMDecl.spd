


// Use the decl's reg for the index?

	
struct SavedRegisters 
	|byte|					RegCount
	|uint16|				BasicBlock
	|uint|					KnownValues
	|DeclAlterable[32]|		Decls
	|uint16[32]|			ASM


	function Collect (|[scdecl]| args, |assembler| sh)
		opt norefcounts

		.BasicBlock = sh.BasicBlock
		.KnownValues = sh.KnownValuesMap
		|| S = sh.FuncStart - 1
		for i in 32
			|| f = sh.Register(i)
			.asm[i] = (f - s, nil)(f)
		
		expect args <= 32 - .RegCount
		for p in args
			.decls[.RegCount++] = p.mu


	function Rewind	(|assembler| sh)
		sh.KnownValuesMap = .KnownValues
		sh.BasicBlock = .BasicBlock
		|| S = sh.FuncStart - 1
		for i in 32
			|| r = .asm[i]
			sh.Register(i) = (s + r, nil)(r)


	function Restore (|[scdecl]| args)
		opt norefcounts

		if args < .RegCount
		for p.backwards in args
			p.mu = .decls[--.RegCount]



struct DeclAlterable 
	|uint64|			ExportPosition
	|SCDeclInfo|		Info
	|DataTypeCode|		DataType
	|uint16| 			ModuleNum



function assembler.DeclReset (|scdecl| D)
	d.exportposition = 0
	(d isnt const)
	d.DepthOfBranch = .state.BranchDepth			// Number scheme is different. ASM doesn't use .DepthOfBranch though?


