

target debug
	|!&CakeVM| TestVM = CakeVM(1MB)

  
extend_module ASM
	function TestASMSub (|message| tests)
		opt norefcounts
		Assembler.sh.ASMInit
		|| list = tests.last(@arg)
		|| TestName = tests[@thg]
		require list and testname

		textassembler.assemble(list)
		target debug
			|| fn = .GetASMFunc(testname)
				|| ff = fn.ÂµTest
				testvm.Registers(true)
				testvm.Run(ff.ptr, ff.length)


	function GetASMFunc (|message| m, |scfunction|)
		cpp_part AccessStr
		opt norefcounts
		return compiler.XFunc(m.name, m)	#expect (m, "This function has no ASM")


	function TestASM 
		target debug
			require options.Modecake and options.dev > 0
			asm.noisyasm = 3		
			using ErrorSeverity.Warning
			|| T = ( file://syntax.asm ).parse[@tmp, "tests"]
				.TestASMSub(T)
	

function message.GetASMFunc (|message|)
	opt norefcounts
	|| op = .next(@opp, "=")
	|| Adj = op.Next(@adj)
		return adj[@func]


