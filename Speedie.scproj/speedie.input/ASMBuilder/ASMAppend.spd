


struct FastASM
	|&uint| Start
	|&uint| Curr
	syntax Append (|uint| Value)
		opt inline
		real self
		|| A = .Curr++
		|| Length = A[]
		if !Length
			A[] = Value
			return
		return .AppendSub(value, length)

	helper AppendSub (|uint| Value, |int| Length)
		real self
		|| NewLength = Length*2
		|| Bigger = Memory.Realloc(self - Length, (NewLength+1)<<2)|&ASM|
			.Start = Bigger
			Bigger[NewLength] = NewLength
			Bigger += Length
			Bigger++[] = Value
			.curr = Bigger
	
	function Alloc (|int| Length, |&asm|)
		|| Buff = Memory.Zalloc((length+1)<<2)|&asm|
			Buff[Length] = Length
			.Start = Buff
			.curr = buff
		return buff
	
	function Read (|VirtualJBString|)
		rz.Addr = .Start|&byte|
		rz.Length = .curr|&byte| - .Start|&byte|
