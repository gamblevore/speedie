

// some kinda function table... saved to a file

module PackMaker
	|[scfunction]|			LibFuncs
	|[SCDecl]|				LibGlobs
	|[scfunction]|			PackFuncs
	|[SCDecl]|				PackGlobs

	
	function AddAll
		opt norefcounts
		for f in Compiler.FuncList
			if !f.CanLibLoad
				0
			  elseif (f.IsStdLib)
				.libfuncs <~ f
			  else
				.packfuncs <~ f
		
	
	function Oof (|[scfunction]| r, |jbin| pack)
		opt norefcounts
		r.sort(ExecSorter)
		
		for (f in r) (i)
			f.TableID = i
			if pack
				pack.Add(@thg, f.exportname)


	function Run (|string|)
		.AddAll
		.oof(.PackFuncs, nil)

		|| pack = jbin()
		pack.enter(@prm) // our funcs
		.oof(.libfuncs, pack)
		pack.exit

		pack.enter(@arr) // our globs
		pack.exit
		return pack


function scfunction.WrappedName (|string|)
	if .iscppinbuilt
		return .exportname + "Wrap"
	  else
		return .exportname

	
helper ExecSorter (sortercomparer)
	return (a|scfunction|).Description < (b|scfunction|).Description


function scfunction.CanLibLoad (|bool|)
	require !.ismacro and !.isdisabled and .iscppinbuilt != 2
	return true
