

import "GUI"

conf
	name	Energy_Chart
	prefs	"theochart.prefs"

targets
	gui



main								// main {
	Â¥.BG = (0.1, 0.2, 0.1)
	sdlapp.RunAndQuit(&chartwindow.App)


class ChartWindow (Window)
	|ChartControl|		View
	|textview|			HumanAge
	constructor
		.View = chartcontrol(self)
		.View.Size = 10~inside by 10~inside
		.HumanAge = textview(self)
		.HumanAge.size = 16~right for 30 by 30~down for 15
		(.HumanAge is editable)
		.HumanAge.OnTextChanged = NewAge

	module
		function App (guiapplicationinit)
			chartwindow().show
		
		function NewAge (GuiTextEvent)
			self.Window|ChartWindow|.view.age = .Text.float
			.touch


class ChartControl (GUIControl) 
	|float|		Age
	behaviour MouseDown
		|| t = .Age.Prog
		|| g  = t.RefillEnergy
		|| pw = t.RefillPower
		beep "energy: $g\n\npower:  $pw"
		
	behaviour Draw
		(where).fillrect(.lastrect, (0.5, 0.1, 0.6), (0.1, 0.5, 0.3))
		|| cl = where.ControlClip
		|| b = cl.xy.vec2
		|| cls = cl.size.vec2
		|| scale = (1.0, 1.0) / cls
		for (p in where) (v)
			|| vs = (v.vec2-b)*scale
			p <~ ((vs, 0.0))
		|| y = cls.y / 24.0
		|| w = Colors.white
		|| bl = Colors.black
		|| OverWorked = .Age.Prog
		for i in cls.x*12
			|| t = (i*scale.x)|progression| // 0-12
			|| xc= i/12.0					// 0-cl.w
			|| e = t.energy
			|| p = t.power
			|| rp = t.RefillPower
			|| re = t.RefillEnergy
			where[((xc,re*y)+b).ivec2] <~ bl
			where[((xc,rp*y)+b).ivec2] <~ bl
			where[((xc,e *y)+b).ivec2] <~ W
			where[((xc,p *y)+b).ivec2] <~ W
		|| overworkedf = OverWorked/12.0
		|int| x = cl.x + cl.width*OverWorked
		|| A0 = (x, cl.y1)
		|| A1 = (x, cl.y2)
		Where.DrawRect((A0,A1))


function Float.Prog (|Progression|)
	return self / 7.0

datatype Progression (float)
	function RefillEnergy (|float|)
		rz = self min 4
		rz -= (self-4.0).clamp(0,1.5)*4
		rz += (self-5.5).clamp(0,6.5)*4		// :)
	function RefillPower (|float|)
		return .RefillEnergy * .Energy
	function Energy (|float|)
		rz = self min 4
		rz += (self-04).clamp(0, 6)*2
		rz += (self-10).clamp(0, 2)*4		// :)
	function Power (|float|)
		return .Energy pow 2
