

/*
	Jeebox internals. By Theodore H. Smith...
*/


module Terminal
	|array of array|	Screen
	|faststring| 		fs
	||					baseline = 0

	constants
		w = 80
		h = 35 // too many lines will break the clearscreen/reset function!
		TermClear = "\1b[2J"
		TermReset = "\1b[1;1H"

		
	syntax append (|string| text, |int| x = 0, |int| y = -1, |int| Colors=0)
		if y == -1
			y = .baseline++
		|| within = 0
		for c in text
			if c.istextline
				y++
				within = 0
			|| xx = x+within
			if xx inrange w  and  y inrange h
				.Screen[y][x] = string[c]
			within++
	

	function Clear
		if !.Screen
			for h
				.Screen <~ [("", w)]
			(TermClear).puts
		.baseline = 0

	function Flat (|string|)
		visible
		opt norefcounts
		.fs := FastString()
		for line in .Screen
			for ch in line
				if ch isa string
					.fs <~ ch

	function Display
		if !.screen
			.clear
		|| s = 60th
		app.Sleep(s)
		TermReset.puts
		.flat.puts
		

helper string.puts
	.cstr.cstring.puts
