


function CakeRun.LoadClasses (|bool|)
	opt norefcounts
	for cd in ClassData.First_
		.StoreClass(cd)

/	for c.fast in .Clss
		.LoadOneClass(C)
	return StdErr.ok


function CakeRun.SyntaxAccess (|message| m, |&ClassData|)
	opt norefcounts
	if m
		|| obj = .ClassTable[m.name]
			return (obj.PrivValue)|&Classdata|
		error (m, "Can't find class: " + m.name )


function CakeRun.StoreClass (|ClassData| cd)
	|| name = cd.Name.wrap
	.ClassTable.ValueLower(name) = cd
	if name ~= "object"
		.obj = cd
	

function Cakerun.LoadOneClass (|message| s)
	opt norefcounts
	|| c = S[@list]
	|| Num = c[@num]
	|| I = Num.int									#require
	
	|| Where = ((CakeRun.GlobBase!)|&byte| + I)|&?&classdata|
	|| PackClass = c.next
	if !PackClass			// a native class. lets store in globs
		where[0] = cakerun[s]
		return

	|| sz = c[2].int
	|| P = cakerun[c[@thg, 1]]

	|| Name = s.Name
	Name.Addr[name.Length] = 0 // :]
	|| ClsData = Classdata.CakeNew(name.Addr|cstring|, sz, p)
	where[0] = ClsData
	cakerun.ClassTable[name] = ClsData

	for V in C.next(@list)
		// what do these numbers represent? it has to be from the func-table, right?
		// shouldn't we process them after processing the func-table?
		// lets do the func-table first!

/*
How to cross-call? Single-table, and branch

* From Cpp using branch. (GOOD! HAPPY WITH THIS)
	* Cpp is easy
	* finds SPD
		* LongJump
		* Run VM
	* wrap SPD in a C-func
		* awkward and not fun

* From SPD using branch (EASY BUT IM NOT HAPPY WITH IT. WHY?)
	* spd is easy
	* cpp is easy
	* SPeedie is not virtual obsessed
		* Just make it work!
		* Speedie is all about direct calls... or function pointers.
		* virtuals are just to get things working. just deal with it!

tmp tetris
	list ...
	list
		unit "Destructor"
			num "64"
		unit "Render"
			num "3455"
*/


function cakerun.NewBehaviour (|int| n, |$?&&nil| Cpp, |$?&&nil| Spd) 
	cpp_Wrapper JBClassAllocBehaviour


// maybe should allocate behaviour too. Assume all spd funcs.
function @ClassData.CakeNew  (|cstring| Name, |int| Size, |?&ClassData| Parent, |&ClassData|)
	cpp_wrapper JBClassNew

	


datatype BaseType (int)
	constants (
		|BaseType|
		Module = 0 // not actually a type
		Nil
		Object
		Struct
		DataType
		FuncProto
	)
	syntax is (|BaseType| d, |bool|)
		return self == d

