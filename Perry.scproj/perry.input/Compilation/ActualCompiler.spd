

function PerryIDE.ACTUAL_COMPILE
	expect !.compilr (beep)  // wah?
/	require .FileList.SaveAll(DocumentState.saving)

	|| args = ["--nocolor"]
	if .DebugMode is Debug
		args <~ "--hideaway" // store the scripts in a hidden temp folder

	if .name ~= "Speedie.scproj"
		args <~ "--perry"
	  else
		args <~ "--perry=bin"

	if .DebugMode is Debug or Cake  
		args <~ "--bake"
	args <~ .project

	.compilr = UnixProcess.spawn(speedie, args, processmode.captureall)
	if .compilr
		.GUIIsCompiling(args)



function PerryIDE.RUN_COMPILE (|file| f, |[string]| args)
/	|| out = .DebugAppCallArgsDisplay(F, args)
	|| str = out.GetResult
	.ProductOut.Log(str, 256K)
	.LogOneAction(str)
	out <~ ("\n", 2)

	|unixprocess| r
	if .DebugMode is debug
		ifn f isa "cake" // oof?
		r = SPDProcess.spawn(f, args, ProcessMode.OwnGroup, f.name)
	  else
		r = UnixProcess.spawn(f, args, ProcessMode.OwnGroup)
	if r and r.PID
		.RunCompiledApp = r
		.ShowProductIfMoreOutput = 0
		.RunButton.text = "\07"



function PerryIDE.RUN_COMPILE_WRAP (|file!| product)
	.DebugArgsText.InitDebugArgs
	|| DebugArgs = .DebugArgs						#require
	|| ArgMsg = DebugArgs["args"]					#require
	
	ArgMsg = ArgMsg.Copy
	argmsg.Ask
	
	|| f = product
	|| args = ArgMsg.DebugArgNames
	if product.IsDir and Platform.OSX
		f = product.Child("Contents/MacOS/" + f.TrimExtAndPath)!
	
	|| old = app.cwd
	.DebugPath(debugargs)	
	.DebugEnvs(debugargs["env"])		
	.RUN_COMPILE(f, args)

	if !StdErr.ok
		.DebugArgsText.FillErrors(StdErr)
		|| err = StdErr.LastError
			Notifications <~ err
	app.cwd = old

