#!/usr/local/bin/spd

main 
	|| path = app.args[0]				#expect ("Pass a file-path")
	|| B = path.ExistingFile			#require
	|| jb = B.Parse						#require
	if b isa "xml"
		jb.XMLToJeebox
		|| BoxFile = path.Ext("box")
		if BoxFile <~ jb.render		// write file to disk
			"Converted XML to Jeebox: $boxfile"

	|| Queries = app.Switches
	|| Found = BookSearch(jb, Queries)
		""
		for bk in found
			"$bk"
	  else
		"Can't find any books by: $Queries"
		
		
function BookSearch (|message| BookFile, |[string]| Queries,  |[message]|)
	for book in BookFile[@tmp, "catalog"][@arg]
		if book.TestBook(Queries)
			rz <~ book


function message.TestBook (|[string]| queries, |bool|)
	require .Expect(@tmp, "book")			// validate :)
	for row in self[@arg,-1]
		for Q in queries
			if row ~= q.ArgName		// ~= is like == but case-insensitive
				require row.first.name contains q.ArgValue
				rz = true
			
	
