#!/usr/local/bin/spd

https://github.com/gamblevore/speedie/blob/main/Documentation/Message.md // docs here
file:///usr/local/speedie/Documentation/Messages.md						 // locally

main (|existingfile| input)
	|| jb = input.parse$
	if input isa "xml"
		jb.XMLToJeebox
		|| BoxFile = input.setext("box")
		if BoxFile <~ jb		// write to disk
			"Converted XML to Jeebox: $boxfile"

	|| Found = BookSearch(jb, app.Switches)
		""
		for bk in found
			"$bk"
	  else
		"Can't find any books using: ${app.Switches}"
		
		
function BookSearch (|message| BookFile, |[string]| Queries, |[message]|)
	|| list = BookFile[@tmp, "catalog"][@arg]
	for book in list
		if book.Expect(@tmp, "book") 
			rz <~ book.TestBook(Queries)


function message.TestBook (|[string]| queries, |message|)
	for row in .last(@arg)
		require row.Expect(@tmp)
		for Q in queries
			if row ~= q.ArgName
				|| Value = Row[@nil]
					require Value.name contains q.ArgValue
					rz = self
