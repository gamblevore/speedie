

class StringShared (string)
	linkage
		wrapper
		cpp_class JB_StringShared
		cpp_part Str

	cpp_refs
		Disturbs		nil
	
	constructor (|string| data)
		cpp_wrapper JB_Str_Clone

	default			""



class MessageID (stringshared)
	contains object
	|Syntax|			Func
	||					Obj
	|uint64|			ID
	|uint64|			Frequency
	
	constructor (|string| Name="", |Syntax| Fn=nil)
		super.constructor(name)
		.Func = fn
		.obj = nil // c++ generator fails otherwise
	
	function Msg (|message| parent, |message|)
		return Message(parent, .func, -1, .name, .name.length)
	
	module
		function IDSorter (SorterComparer)
			return a|MessageID|.Frequency  <  b|MessageID|.Frequency



function Message.Identify (|&(MessageDict of messageid)| d,  |[messageid]| table,  |int|)
	visible
	opt NoRefCounts
	for s.flat in self
		|| Found = d.makeplace(s)
		|| ID = *found
			ID.Frequency++
		  else
			id = MessageID(s.name, s.func)
			if table
				table <~ id
			*found = id
			rz += s.name.Length
		s.Name = id



struct MessageDict 
	contains object
	|(dictionary of ...)[64]| D
	
	function MakePlace (|message| m, |&...|)
		opt norefcounts
		|| fn = m.func
		if fn|int| < 64
			|| pl = &.d[fn]
			|| v = (*pl) init dictionary()
			return v.makeplace(m.name)
	destructor
	
			
